=== COPY THIS ENTIRE PROMPT TO YOUR AI ASSISTANT ===

# Frontend Migration to MCP Platform

## Context
We have a new MCP backend platform with agent orchestration, runtime management, and observability. Update the frontend to integrate with this platform.

## Backend APIs (Use These)

### MCP Server Generation
POST /ai/generate-mcp-server
Body: { "prompt": "...", "ownerId": "user_default" }
Returns: { serverId, name, tools, resources, status }

### Server Management
GET /mcp/servers?ownerId=user_default
GET /mcp/servers/:serverId?ownerId=user_default

### Runtime Control
POST /mcp/servers/:serverId/runtime/start
POST /mcp/servers/:serverId/runtime/stop
Body: { "ownerId": "user_default" }

### Tool Invocation
POST /mcp/servers/:serverId/invoke
Body: { "ownerId": "user_default", "agentId": "...", "toolId": "...", "input": {...} }

### Agent Management
POST /agents
Body: { "name": "...", "allowedTools": [...], "ownerId": "user_default" }

POST /agents/:agentId/attach/:serverId
Body: { "ownerId": "user_default" }

### Observability
GET /mcp/topology?ownerId=user_default
GET /mcp/events?limit=100

## Tasks

### 1. Update Chat Component
File: frontend/components/ChatShell.tsx

Replace workflow generation with MCP server generation:
- Remove: POST /ai/generate-workflow
- Add: POST /ai/generate-mcp-server
- Store serverId in state
- Auto-create and attach agent
- Navigate to MCP dashboard

### 2. Create MCP Dashboard
File: frontend/app/mcp/page.tsx (NEW)

Create dashboard with:
- Server list (left panel)
- Runtime controls (center)
- Activity feed (right panel)
- Topology visualization

### 3. Create Components
Files: frontend/components/mcp/*.tsx (NEW)

Create these components:
- MCPServerList.tsx - Display servers, select active
- RuntimeControls.tsx - Start/stop buttons
- ActivityFeed.tsx - Event stream (poll every 2s)
- TopologyGraph.tsx - Visual graph
- AgentList.tsx - Display agents

### 4. State Management
File: frontend/lib/mcpStore.ts (NEW)

Create state structure:
```typescript
interface MCPState {
  currentServerId: string | null;
  currentAgentId: string | null;
  servers: MCPServer[];
  agents: MCPAgent[];
  topology: Topology | null;
  events: MCPEvent[];
  runtimeStatus: 'running' | 'stopped' | 'not_loaded';
}
```

### 5. Update Navigation
Add link to MCP Dashboard in navigation component

## Key Functions to Implement

```typescript
// Generate MCP server
async function generateMCPServer(prompt: string) {
  const response = await fetch(`${API_URL}/ai/generate-mcp-server`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ prompt, ownerId: 'user_default' })
  });
  return await response.json();
}

// Create and attach agent
async function createAndAttachAgent(serverId: string, tools: any[]) {
  const agentRes = await fetch(`${API_URL}/agents`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      name: 'Auto Agent',
      allowedTools: tools.map(t => t.toolId),
      ownerId: 'user_default'
    })
  });
  const { agentId } = await agentRes.json();
  
  await fetch(`${API_URL}/agents/${agentId}/attach/${serverId}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ ownerId: 'user_default' })
  });
  
  return agentId;
}

// Start runtime
async function startRuntime(serverId: string) {
  await fetch(`${API_URL}/mcp/servers/${serverId}/runtime/start`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ ownerId: 'user_default' })
  });
}

// Fetch events (poll every 2 seconds)
async function fetchEvents(serverId?: string) {
  const params = serverId ? `?serverId=${serverId}&limit=50` : '?limit=50';
  const response = await fetch(`${API_URL}/mcp/events${params}`);
  return await response.json();
}

// Fetch topology
async function fetchTopology() {
  const response = await fetch(`${API_URL}/mcp/topology?ownerId=user_default`);
  return await response.json();
}
```

## User Flow

1. User enters prompt in chat
2. Frontend calls /ai/generate-mcp-server
3. Store serverId
4. Auto-create agent with all tools
5. Attach agent to server
6. Navigate to /mcp dashboard
7. User starts runtime
8. Activity feed shows events
9. Topology displays graph

## Environment Variables
NEXT_PUBLIC_API_URL=http://localhost:4000
NEXT_PUBLIC_OWNER_ID=user_default

## Success Criteria
- Chat generates MCP server (not workflow)
- MCP Dashboard displays servers
- Runtime can be started/stopped
- Activity feed updates automatically
- Topology shows nodes and edges
- No console errors

## Implementation Priority
Phase 1 (Critical):
1. Update chat to use /ai/generate-mcp-server
2. Create MCP state management
3. Create MCP Dashboard page
4. Create MCPServerList component
5. Create RuntimeControls component

Phase 2 (Important):
6. Create ActivityFeed component
7. Create TopologyGraph component
8. Create AgentList component
9. Update navigation
10. Auto-create agent flow

## Documentation
Full details in: FRONTEND-MCP-MIGRATION-PROMPT.md
Quick reference: FRONTEND-QUICK-REFERENCE.md
Backend API: MCP-PLATFORM-INTEGRATION.md

=== END OF PROMPT ===
